{% extends "base.html" %}

{% load tagging_tags %}
{% load comments_tags %}
{% load item_extras %}
{% load distro_extras %}

{% block title %}{{ item.headline }}{% if item.group %} - {{ item.group }}{% endif %} - {{ current_site.name }}{% endblock title %}
{% block description %}{% if item.summary %}<meta name="description" content="{{ item.summary }}" />{% endif %}{% endblock description %}
{% block meta %}
	{% if item.valid_youtube %}
		<meta property="og:type" content="video" />
		<meta property="og:video" content="http://www.youtube.com/v/{{ item.valid_youtube }}?version=3&amp;autohide=1" />
		<meta property="og:video:height" content="224" />
		<meta property="og:video:width" content="398" />
		<meta property="og:video:type" content="application/x-shockwave-flash" />
	{% else %}
		<meta property="og:type" content="article" />
		<meta property="og:video" content="http://{{ current_site.domain }}{{ request.get_full_path }}" />
		<meta property="og:video:type" content="text/html" />
	{% endif %} 
	<meta property="og:title" content="{{ item.headline }}" />
	<meta property="og:url" content="http://{{ current_site.domain }}{{ request.get_full_path }}" />
	<meta property="og:image" content="{{ item.video.get_freeze_img_relative_url }}" />
	<meta property="og:site_name" content="{{ current_site.name }}" />
	<meta property="og:description" content="{{ item.summary }}" />
{% endblock meta %}
{% block bodyid %} id="details"{% endblock bodyid %}

{% block content %}

	{% if item %}

		{% tags_for_object item as tags %}

		<div class="section">

			<div class="main-column">

				<h2>{{ item.headline }}</h2>

				{% if video_status  == "Youtube" %}

				<iframe width="640" height="360" src="http://www.youtube.com/embed/{{ foreign_video_embed_id }}?modestbranding=1{% if autoplay%}&amp;autoplay=1{%endif%}&amp;rel=0&amp;wmode=transparent" frameborder="0" allowfullscreen></iframe>

				<p id="youtube-player-notice"><strong>Note:</strong> This video is still being imported from YouTube, but once it is finished processing it will be shown in the VidCaster player.</p>

				{% else %}

				{% if item.valid_youtube %}

				<iframe width="640" height="360" src="http://www.youtube.com/embed/{{ item.valid_youtube }}?modestbranding=1{% if autoplay%}&amp;autoplay=1{%endif%}&amp;rel=0&amp;wmode=transparent" frameborder="0" allowfullscreen></iframe>

				{% else %}	

				<iframe title="{{ current_site.name }} Video Player" width="640" height="360" src="http://{{ current_site.domain }}/player/{{ item.code }}/native/" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

				{% endif %}

				{% endif %}

				<p class="meta group">

					<span class="date">Posted on {{ item.pub_date|date:"F j, Y" }}</span>
				
					{% if item.group %}
				
					<span class="category {{ item.group.short_name }}">Category: {{ item.group.get_html_tag|safe }}</span>
				
					{% endif %}
				
					{% if perms.items.can_edit_all %}
					
					<span class="edit"><a href="{{ item.get_absolute_url }}edit/">edit this video</a></span>
					
					{% endif %}

				</p>

				{% if item.summary %}

				<div class="summary">

					<p>{{ item.summary }}</p>

				</div>

				{% endif %}

				{% if item.desc %}

				<div class="description">

					{% if html_desc %}
					{{ item.desc|safe|urlize|linebreaks }}
					{% else %}
					{{ item.desc|urlize|linebreaks }}
					{% endif %}

				</div>

				{% endif %}

				{% if tags %}

				<div id="tags" class="block">

					<div class="block-header">

						<h3>Tags</h3>

					</div>

					<p>{% for tag in tags %}{% if not forloop.first %}, {% endif %}<a href="/videos/tagged/{{ tag|urlencode }}/" rel="tag">{{ tag }}</a>{% endfor %}</p>

				</div>

				{% endif %}
	
			</div>

			<div class="sub-column">

				<div id="related" class="block video-list">

					<div class="block-header">
	
						<h3>Related Videos</h3>
	
					</div>
	
					{% if related_items %}
	
					<ol>
	
						{% for related_item in related_items %}
	
						<li>
							<a class="thumbnail" href="{{ related_item.get_absolute_url }}"><img src="{% fetch_thumbnail_url related_item 143 90 %}" alt="" /><span></span></a>
							<h4 class="title"><a href="{{ related_item.get_absolute_url }}">{{ related_item.headline }}</a></h4>
						</li>
	
						{% endfor %}
	
					</ol>
	
					{% else %}
	
					<p>There are no related videos for this video.</p>
	
					{% endif %}
	
					{% if item.geo_long %}
	
					<div id="map">
						<div id="map-container" style="width: 280px; height: 285px"></div>
						<span id="id_geo_long">{{ item.geo_long|default_if_none:"" }}</span>
						<span id="id_geo_lat">{{ item.geo_lat|default_if_none:"" }}</span>
					</div>

					{% endif %}

				</div>

			</div>

		</div>

		<div class="section">

			<div class="main-column">

				{% if current_site.siteprofile.allow_comments and preview = "False" %}

				{% comments_for_object item as comments %}

				<div id="comments">

					<div class="block simple-form{% if user.is_authenticated %} authenticated{% else %} unauthenticated{% endif %}">

						<div class="block-header">

							<h3>Post a Comment</h3>

						</div>

						{% comment_form_for_object item %}

					</div>

					{% if comments %}

 					<div class="block comment-list">

						<ol>

							{% for comment in comments %}

							<li id="comment{{ comment.id }}" class="{% if comment.poster_is_registered %}registered{% else %}unregistered{% endif %}">

								<div class="text">
									{{ comment.comment|urlize|linebreaks }}
								</div>
								<div class="meta">
									<p><strong>{{ comment.get_poster_html_tag|safe }}</strong> {{ comment.date|timesince }} ago.</p>
								</div>

							</li>

							{% endfor %}

						</ol>

					</div>

					{% endif %}

				</div>

				{% endif %}

				{% if tags %}

				<div id="tags" class="block">

					<div class="block-header">

						<h3>Tags</h3>

					</div>

					<p>{% for tag in tags %}{% if not forloop.first %}, {% endif %}<a href="/videos/tagged/{{ tag|urlencode }}/" rel="tag">{{ tag }}</a>{% endfor %}</p>

				</div>

				{% endif %}
	
			</div>

			<div class="sub-column">

				<!-- Most Popular -->

				<div id="popular-videos" class="block video-list">

					{% if top_viewed_items %}

					<div class="block-header">

						<h3>Most Popular</h3>

					</div>

					<ol class="group">

	   					{% for item in top_viewed_items %}

						<li>

							<a class="thumbnail" href="{{ item.get_absolute_url }}"><img src="{% fetch_thumbnail_url item 143 90 %}" alt="" /><span></span></a>

							<h4 class="title"><a href="{{ item.get_absolute_url }}">{{ item.headline }}</a></h4>

						</li>

	   					{% endfor %}

					</ol>

					{% if total_items > 5 %}

					<div class="video-list-actions">

						<p><a href="/videos/archive/?page=2">View {{ total_items|add:"-10" }} more video{{ total_items|add:"-10"|pluralize }}&nbsp;&rarr;</a></p>

					</div>

					{% endif %}

					{% endif %}

				</div>

			</div>

		</div>

	{% else %}

		<div class="section">

			<div class="page-header">

				<h1>Item not found.</h1>

			</div>

		</div>

	{% endif %}

{% endblock content %}

{% block page-scripts %}

		{% if item.geo_long %}

		<script src="http://maps.google.com/maps/api/js?sensor=false"></script>

		{% endif %}

{% endblock page-scripts %}
